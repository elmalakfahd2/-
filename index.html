<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#667eea"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</title>
<link rel="manifest" href="manifest.json">
<style>
/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© --- */
* { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
}

body {
    font-family: 'Arial','Segoe UI',sans-serif;
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    margin:0;
    padding:10px;
    min-height:100vh;
    line-height:1.6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    position: relative;
    padding-bottom: 10px;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
input, select, .calculation-info, .calculation-steps, 
.summary, .analysis-table, .billet-result, .bed-length-result,
.step, .bed-length-step, .analysis-table td, .analysis-table th {
    font-family: 'Arial', 'Segoe UI', sans-serif !important;
    font-feature-settings: "lnum";
    -moz-font-feature-settings: "lnum";
    -webkit-font-feature-settings: "lnum";
    font-variant-numeric: lining-nums;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„Ù„ÙŠØ³Ø§Ø± */
input[type="number"], input[type="text"] {
    direction: ltr;
    text-align: right;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ÙŠØ³Ø§Ø± */
.calculation-info span, .billet-result span, .summary span,
.analysis-table td, .bed-length-value {
    direction: ltr;
    display: inline-block;
    text-align: right;
}

/* --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø· --- */
.welcome-wrap {
    text-align: center;
    margin-bottom: 12px;
}
.welcome-banner {
    display: inline-block;
    padding: 8px 14px;
    border-radius: 10px;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    color: #fff;
    font-weight: 700;
    font-size: 16px;
    letter-spacing: 1px;
    text-shadow: 0 0 6px rgba(255,255,255,0.85);
    animation: bannerGlow 3s ease-in-out infinite alternate, bannerFloat 6s ease-in-out infinite;
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    border: 1px solid rgba(255,255,255,0.08);
}
@keyframes bannerGlow {
    from { text-shadow: 0 0 6px rgba(255,255,255,0.6), 0 0 10px rgba(255,215,0,0.3); transform: translateZ(0) scale(1); }
    to   { text-shadow: 0 0 18px rgba(255,255,255,0.9), 0 0 26px rgba(255,140,0,0.25); transform: translateZ(0) scale(1.02); }
}
@keyframes bannerFloat {
    0% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
    100% { transform: translateY(0); }
}

.container {
    max-width:880px;
    margin:0 auto;
    background:#fff;
    padding:20px;
    border-radius:16px;
    box-shadow:0 12px 30px rgba(0,0,0,0.25);
}
h1{color:#2c3e50;text-align:center;margin-bottom:6px;font-size:24px}
.subtitle{text-align:center;color:#7f8c8d;margin-bottom:14px;font-size:14px}

.section-title{color:#2c3e50;margin:14px 0 10px 0;padding-bottom:6px;border-bottom:2px solid #ecf0f1;font-size:16px}

/* ---------- ØªØ­Ø³ÙŠÙ† Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ³Ø§ÙˆÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ ---------- */
.form-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap:12px;
    margin-bottom:14px;
    align-items: start;
}

.form-group{
    margin-bottom:0;
    display: flex;
    flex-direction: column;
    height: 100%;
}

label{
    display:block;
    margin-bottom:6px;
    font-weight:700;
    color:#34495e;
    font-size:13px;
    line-height: 1.3;
    min-height: 32px;
}

input,select,textarea,button{
    width:100%;
    padding:8px;
    border:1.8px solid #bdc3c7;
    border-radius:6px;
    font-size:13px;
    background:#f8f9fa;
    transition:all .18s;
    font-family: 'Arial', sans-serif !important;
    min-height: 38px;
    box-sizing: border-box;
}
input:focus,select:focus,textarea:focus{border-color:#3498db;outline:none;background:#fff;box-shadow:0 0 0 3px rgba(52,152,219,0.04)}

.small {
    font-size: 11px; 
    color: #7f8c8d; 
    margin-top: 6px;
    line-height: 1.3;
    min-height: 28px;
}

.buttons-group{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin:12px 0}
button{
    color:#fff;
    padding:10px;
    border:none;
    border-radius:8px;
    font-size:14px;
    font-weight:800;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    transition: all 0.3s ease;
}
.calculate-btn{background:linear-gradient(135deg,#27ae60,#2ecc71)}
.reset-btn{background:linear-gradient(135deg,#e74c3c,#c0392b)}
.print-btn{background:linear-gradient(135deg,#34495e,#2c3e50)}
button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 12px rgba(0,0,0,0.15);
}
button:active{
    transform:translateY(0);
}

.result{margin-top:12px;padding:12px;background:linear-gradient(135deg,#ecf0f1,#dfe6e9);border-radius:10px;text-align:center;display:none;border:1.8px solid #3498db}
.calculation-info{background:#fff;padding:10px;border-radius:6px;margin:6px 0;text-align:right;box-shadow:0 4px 8px rgba(0,0,0,0.04)}
.billet-result{font-size:20px;color:#e74c3c;font-weight:900;margin:10px 0;padding:10px;background:#fff;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.06)}
.calculation-steps{background:#fff;padding:10px;border-radius:6px;margin:8px 0;text-align:right;font-size:13px;line-height:1.4;box-shadow:0 4px 8px rgba(0,0,0,0.03)}
.step{margin:6px 0;padding:6px;background:#f8f9fa;border-radius:5px;border-right:3px solid #3498db}

.summary{margin-top:8px;text-align:right;background:#fff;padding:8px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.04);font-size:13px}

.analysis-table{margin-top:10px;width:100%;background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.04);border:1px solid #d0e6ff}
.analysis-table table{width:100%;border-collapse:collapse;direction:rtl}
.analysis-table th,.analysis-table td{padding:8px 10px;text-align:right;font-size:13px;border-bottom:1px solid #eef6ff}
.analysis-table thead{background:linear-gradient(90deg,#e6f2ff,#f7fbff);color:#114b8a;font-weight:700}
.analysis-table .highlight{font-weight:900;color:#e74c3c}

.whatsapp-row {
    margin-top:12px;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
}

.whatsapp-btn {
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:#25D366;
    color:white;
    padding:8px 12px;
    border-radius:20px;
    text-decoration:none;
    font-weight:800;
    box-shadow:0 6px 12px rgba(37,211,102,0.14);
    border: 2px solid rgba(0,0,0,0.03);
    font-size: 13px;
}
.whatsapp-btn svg { width:18px; height:18px; }

.mold-management {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    border: 1.6px solid #e9ecef;
}
.mold-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 6px;
    margin-top: 8px;
}
.mold-btn {
    padding: 8px;
    font-size: 12px;
    border-radius: 6px;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
}
.mold-save { background: #27ae60; }
.mold-search { background: #3498db; }
.mold-show { background: #9b59b6; }
.mold-delete { background: #e74c3c; }
.mold-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.08); }

.auto-fill-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border: 2px solid #3498db;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 4px;
    vertical-align: middle;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.auto-fill-notice {
    background: #e8f4fd;
    border: 1px solid #b6e0fe;
    border-radius: 5px;
    padding: 6px 10px;
    margin: 6px 0;
    font-size: 12px;
    color: #1e6fa8;
    display: none;
}

.bed-length-result {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    border: 1.6px solid #90caf9;
    text-align: center;
}
.bed-length-title {
    font-size: 16px;
    font-weight: 900;
    color: #1565c0;
    margin-bottom: 6px;
}
.bed-length-value {
    font-size: 18px;
    font-weight: 900;
    color: #e65100;
    margin: 6px 0;
}
.bed-length-details {
    background: #fff;
    padding: 8px;
    border-radius: 6px;
    margin: 8px 0;
    font-size: 13px;
    text-align: right;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}
.bed-length-step {
    margin: 5px 0;
    padding: 6px;
    background: #f3f9ff;
    border-radius: 5px;
    border-right: 2px solid #42a5f5;
}

.install-btn {
    position: fixed;
    bottom: 15px;
    left: 15px;
    background: #e74c3c;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
    font-size: 13px;
}

.contact-phones {
    margin: 12px 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
}

.phone-contact-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 8px 12px;
    border-radius: 18px;
    text-decoration: none;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    transition: all 0.25s ease;
    border: 1.5px solid rgba(255,255,255,0.2);
    min-width: 180px;
    justify-content: center;
    font-size: 13px;
}

.phone-contact-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    background: linear-gradient(135deg, #764ba2, #667eea);
}

.custom-length-section {
    background: #f8f9fa;
    padding: 8px;
    border-radius: 6px;
    margin: 6px 0;
    border: 1.4px solid #e9ecef;
}

.length-toggle {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
}

.toggle-btn {
    flex: 1;
    padding: 6px 8px;
    border: 1.5px solid #bdc3c7;
    background: #fff;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    font-size: 12px;
    transition: all 0.15s;
}
.toggle-btn.active {
    background: #3498db;
    color: white;
    border-color: #2980b9;
}

.custom-length-input {
    display: none;
}

.custom-length-input.active {
    display: block;
}

.custom-length-input input {
    margin-top: 4px;
    padding:6px;
}

/* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…ÙŠØ¯ÙŠØ§: Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø­ØªÙ‰ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
@media (max-width: 420px) {
    .container { padding:12px; }
    h1{font-size:20px}
    .form-grid { 
        grid-template-columns: repeat(2, 1fr); 
        gap:8px; 
    }
    input, select { 
        padding:6px; 
        font-size:12px; 
        min-height: 36px;
    }
    label {
        font-size: 12px;
        min-height: 28px;
    }
    .small {
        font-size: 10px;
        min-height: 24px;
    }
    .buttons-group { grid-template-columns: 1fr 1fr 1fr; gap:6px; }
    .mold-buttons { grid-template-columns: 1fr 1fr; gap:6px; }
    .phone-contact-item { min-width: 140px; font-size:12px; padding:7px 10px; }
    .welcome-banner { font-size:13px; padding:6px 10px; }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
.english-numbers {
    font-family: 'Arial', sans-serif !important;
    font-feature-settings: "lnum";
    -moz-font-feature-settings: "lnum";
    -webkit-font-feature-settings: "lnum";
    font-variant-numeric: lining-nums;
    direction: ltr;
    text-align: right;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… lining nums */
html, body, input, select, textarea, button, span, p, label, div, table, td, th {
    font-feature-settings: "lnum" 1;
    font-variant-numeric: lining-nums;
}

/* Ø¹Ù†Ø§ØµØ± ØªØ¸Ù‡Ø± Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ Ù†Ø·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ø§ØªØ¬Ø§Ù‡ LTR Ù„ØªØ¶Ù…Ù† Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
span.english-numbers, .calculation-info span, .analysis-table td, .analysis-table th, .bed-length-value {
    direction: ltr !important;
    text-align: right !important;
}

/* ØªØµØºÙŠØ± Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†Ø³Ø®Ø© */
.compact-group label {
    font-size: 11px !important;
    min-height: 26px !important;
}

.compact-group input {
    font-size: 11px !important;
    padding: 5px 6px !important;
    min-height: 34px !important;
}

.compact-group .small {
    font-size: 9px !important;
    min-height: 22px !important;
}

</style>
</head>
<body>

<!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<button class="install-btn" id="installButton">ğŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

<!-- Ø¨Ø§Ù†Ø± -->
<div class="welcome-wrap">
    <div class="welcome-banner">âœ§ï½¥ï¾Ÿ: *âœ¿ ØªØ·ÙˆÙŠØ± ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² FAHD ABD ELAZIZ âœ¿* :ï½¥ï¾Ÿâœ§</div>
</div>

<div class="container">
    <h1>ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</h1>
    <p class="subtitle">Ø¯Ø¹Ù… Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªØ¹Ø¯Ø¯Ø© + Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ù…ØªØ²Ø§Ù…Ù† Ù…Ø¹ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ + Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>

    <h3 class="section-title">ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø©) ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬</h3>
    <div class="form-grid">
        <div class="form-group">
            <label for="numOpenings">Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø©):</label>
            <input type="number" id="numOpenings" value="4" min="1" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
        </div>
        <div class="form-group">
            <label for="rodWeight">ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (ÙƒØ¬Ù…):</label>
            <input type="number" id="rodWeight" value="1.2" step="0.01" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆÙ„</div>
        </div>
        <div class="form-group">
            <label for="weightPerMeter">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</label>
            <input type="number" id="weightPerMeter" value="0.200" step="0.001" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆÙ„</div>
        </div>
        <div class="form-group">
            <label for="numCuts">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</label>
            <input type="number" id="numCuts" value="8" min="1" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨</div>
        </div>
        
        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø§Ù„Ù…Ø­Ø³Ù† -->
        <div class="form-group">
            <label for="rodLength">Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯ (Ù…ØªØ±):</label>
            <div class="custom-length-section">
                <div class="length-toggle">
                    <div class="toggle-btn active" data-length="6">6 Ù…ØªØ±</div>
                    <div class="toggle-btn" data-length="6.5">6.5 Ù…ØªØ±</div>
                    <div class="toggle-btn" data-length="custom">Ø·ÙˆÙ„ Ù…Ø®ØµØµ</div>
                </div>
                <div class="custom-length-input" id="customLengthContainer">
                    <input type="number" id="customLength" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø¨Ø§Ù„Ù…ØªØ±" step="0.1" min="1" value="6" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø·ÙˆÙ„ ØªØ±ÙŠØ¯Ù‡ Ù…Ø«Ù„ 4ØŒ 5.5ØŒ 7ØŒ Ø¥Ù„Ø®</div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="billetDiameter">Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù„Ù…ÙƒØ¨Ø³ (Ø¨ÙˆØµØ©):</label>
            <select id="billetDiameter">
                <option value="5">5 Ø¨ÙˆØµØ©</option>
                <option value="6">6 Ø¨ÙˆØµØ©</option>
                <option value="7" selected>7 Ø¨ÙˆØµØ©</option>
                <option value="8">8 Ø¨ÙˆØµØ©</option>
                <option value="9">9 Ø¨ÙˆØµØ©</option>
                <option value="10">10 Ø¨ÙˆØµØ©</option>
                <option value="11">11 Ø¨ÙˆØµØ©</option>
            </select>
        </div>
        <div class="form-group compact-group">
            <label for="moldNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø©)(Ù…Ø«Ø§Ù„: 6621):</label>
            <input type="text" id="moldNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†Ø³Ø®Ø©</div>
        </div>
        <div class="form-group compact-group">
            <label for="moldVersion">Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© (Ù…Ø«Ø§Ù„: 1 Ø£Ùˆ 2):</label>
            <input type="text" id="moldVersion" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
        </div>
        
        <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¹ÙƒØ³: Ø¥Ø¯Ø®Ø§Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ - ØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ù‡Ù†Ø§ -->
        <div class="form-group">
            <label for="inputBilletLength">Ø¥Ø°Ø§ Ø£Ø¯Ø®Ù„Øª Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø³Ù…) Ø§Ø­Ø³Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ:</label>
            <input type="number" id="inputBilletLength" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ø¨Ø§Ù„Ø³Ù…" step="0.1" min="1" class="english-numbers" />
            <div class="small">ÙŠØ±Ø¬Ø¹ Ø§Ù„ÙˆØ²Ù† Ø¨Ø¹Ø¯ Ø·Ø±Ø­ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ ÙˆÙ‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³. Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.</div>
        </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
    <div id="autoFillNotice" class="auto-fill-notice">
        <span class="auto-fill-indicator"></span>
        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
    <div class="mold-management">
        <h3 class="section-title">ğŸ’¾ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨(Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø§Øª)</h3>
        <div class="mold-buttons">
            <button class="mold-btn mold-save" id="saveMoldBtn">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="mold-btn mold-search" id="searchMoldBtn">ğŸ” Ø¨Ø­Ø«</button>
            <button class="mold-btn mold-show" id="showMoldsBtn">ğŸ“‹ Ø¹Ø±Ø¶</button>
            <button class="mold-btn mold-delete" id="deleteMoldBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
        <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ø«Ù„ 6621/1 Ø£Ùˆ 6621/2</div>
    </div>

    <h3 class="section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚</h3>
    <div class="form-grid">
        <div class="form-group">
            <label for="alloy">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨ÙŠÙƒØ©:</label>
            <select id="alloy" title="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø³ÙŠØ¹Ø¯Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ù‚Ù„ÙŠÙ„Ø§Ù‹">
                <option value="1050">1050</option>
                <option value="1070">1070</option>
                <option value="1100">1100</option>
                <option value="3003">3003</option>
                <option value="3004">3004</option>
                <option value="2024">2024</option>
                <option value="6060">6060</option>
                <option value="6063" selected>6063 (Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø¨Ø«Ù‚)</option>
                <option value="6061">6061</option>
                <option value="6005">6005</option>
                <option value="6082">6082</option>
                <option value="6101">6101</option>
                </option>
                <option value="7075">7075</option>
                <option value="5083">5083</option>
            </select>
            <div class="small">Ø¥Ø°Ø§ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ø®ØªØ± Ø§Ù„Ø£Ù‚Ø±Ø¨</div>
        </div>

        <div class="form-group">
            <label for="weightPerCm">ÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù… (ÙƒØ¬Ù…):</label>
            <input type="number" id="weightPerCm" value="0.670" step="0.001" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø·Ø±ØŒ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹</div>
        </div>

        <!-- Ø­Ù‚Ù„ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ Ø§Ù„Ù…Ø¶Ø§Ù -->
        <div class="form-group">
            <label for="buttScrap">Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ (Ù…Ù…):</label>
            <input type="number" id="buttScrap" value="15" step="1" min="0" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¨Ù„ÙŠØª (Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠÙ…ØªØ±)</div>
        </div>

        <div class="form-group">
            <label for="extrusionRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ (ER):</label>
            <input type="number" id="extrusionRatio" value="30" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø± ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ/ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯</div>
        </div>

        <div class="form-group">
            <label for="scrapPercentage">Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (%):</label>
            <input type="number" id="scrapPercentage" value="5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
        </div>

        <div class="form-group">
            <label for="safetyFactor">Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (%):</label>
            <input type="number" id="safetyFactor" value="10" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø§ÙØªØ±Ø§Ø¶ÙŠ 10%Ø› Ù‚Ù„Ù‘Ù„Ù‡ Ù„Ù„Ù€5% Ù„Ùˆ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø«Ø§Ø¨ØªØ©</div>
        </div>

        <div class="form-group">
            <label for="bedScrapLength">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ù…ØªØ±):</label>
            <input type="number" id="bedScrapLength" value="1.5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</div>
        </div>

        <div class="form-group">
            <label for="desiredTons">ÙƒÙ… Ø·Ù† ØªØ±ÙŠØ¯Ù‡ (Ø·Ù†):</label>
            <input type="number" id="desiredTons" value="" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2.5" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø¥Ù† Ù„Ù… ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø·Ù†</div>
        </div>

        <!-- Toggle Ù„ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ù…Ø¹Ù‹Ø§ -->
        <div class="form-group">
            <label for="enableScrapSafety">ØªÙØ¹ÙŠÙ„ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</label>
            <select id="enableScrapSafety">
                <option value="1">Ù…ÙØ¹Ù„</option>
                <option value="0">Ù…Ø¹Ø·Ù„</option>
            </select>
            <div class="small">Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø·ÙŠÙ„ Ø³ÙŠÙØ­Ø³Ø¨ ÙƒÙ„ Ø§Ù„ÙˆØ²Ù† Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ù†Ø³Ø¨ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù†.</div>
        </div>
    </div>

    <div class="buttons-group">
        <button class="calculate-btn" id="calculateBtn">ğŸ§® Ø§Ø­Ø³Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª</button>
        <button class="reset-btn" id="resetBtn">ğŸ”„ Ù…Ø³Ø­</button>
        <button class="print-btn" id="printBtn">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>

    <div id="result" class="result" aria-live="polite">
        <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        <div class="calculation-info">
            <p><strong>ğŸ”§ Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨:</strong> <span id="resultOpenings" class="english-numbers"></span></p>
            <p><strong>âš–ï¸ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯:</strong> <span id="resultRodWeight" class="english-numbers"></span> ÙƒØ¬Ù…</p>
            <p><strong>âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</strong> <span id="resultWeightPerMeter" class="english-numbers"></span></p>
            <p><strong>âœ‚ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</strong> <span id="resultCuts" class="english-numbers"></span></p>
            <p><strong>ğŸ“ Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯:</strong> <span id="resultRodLength" class="english-numbers"></span></p>
            <p><strong>ğŸ“ Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª:</strong> <span id="resultDiameter" class="english-numbers"></span></p>
            <p><strong>ğŸ”© Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong> <span id="resultAlloy"></span></p>
            <p><strong>ğŸ—‘ï¸ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³:</strong> <span id="resultButtScrap" class="english-numbers"></span> Ù…Ù…</p>
            <p><strong>ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ (ER):</strong> <span id="resultExtrusionRatio" class="english-numbers"></span></p>
        </div>

        <div class="billet-result">
            ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetLength" class="english-numbers"></span> Ø³Ù…
        </div>

        <div style="color:#7f8c8d;font-size:14px;margin-top:6px;">
            âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetWeight" class="english-numbers"></span> ÙƒØ¬Ù…
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ -->
        <div id="bedLengthResult" class="bed-length-result" style="display:none;">
            <div class="bed-length-title">ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</div>
            <div class="bed-length-value" id="bedLengthValue" class="english-numbers"></div>
            <div class="bed-length-details" id="bedLengthDetails"></div>
        </div>

        <div id="calculationDetails" class="calculation-steps"></div>

        <div id="analysisBlock" class="analysis-table" style="display:none;">
            <table>
                <thead>
                    <tr><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</th><th>Ø§Ù„Ù†Ø§ØªØ¬</th></tr>
                </thead>
                <tbody id="analysisTableBody"></tbody>
            </table>
        </div>

        <div id="summaryBox" class="summary"></div>

        <!-- Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="contact-phones">
            <a href="tel:01124006047" class="phone-contact-item">
                <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
                </svg>
                01124006047
            </a>
            
            <a href="tel:01120440740" class="phone-contact-item">
                <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
                </svg>
                01120440740
            </a>
        </div>

        <!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
        <div class="whatsapp-row">
            <a class="whatsapp-btn" href="https://wa.me/201124006047" target="_blank" rel="noopener noreferrer" title="Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.52 3.478A11.79 11.79 0 0012 0C5.373 0 .01 5.373.01 12c0 2.12.56 4.17 1.62 5.97L0 24l6.24-1.62A11.93 11.93 0 0012 24c6.627 0 12-5.373 12-12 0-2.99-1.17-5.78-3.48-7.522z" fill="#25D366"/>
                    <path d="M17.4 14.1c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15s-.77.97-.95 1.17c-.17.2-.34.22-.64.07-1.71-.85-2.83-1.5-3.96-3.42-.3-.52.3-.49.86-1.62.09-.17.05-.31-.02-.46-.07-.15-.67-1.62-.92-2.22-.24-.58-.48-.5-.66-.51l-.56-.01c-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.27 0 1.34.98 2.63 1.12 2.81.14.17 1.93 3.12 4.68 4.37 1.63.7 2.37.75 3.22.63.49-.07 1.5-.61 1.71-1.21.21-.6.21-1.11.15-1.22-.06-.1-.22-.15-.52-.3z" fill="#fff"/>
                </svg>
                ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
            </a>
        </div>
        <div class="whatsapp-note">Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ù‚Ù… 01124006047</div>
    </div>
</div>

<script>
// ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
const baseBilletWeights = { 
    '5': 0.342, 
    '6': 0.493, 
    '7': 0.670, 
    '8': 0.876, 
    '9': 1.108,  
    '10': 1.368,
    '11': 1.656
};

const alloyFactor = {
    '1050':0.98, '1070':0.99, '1100':0.96, '3003':1.00, '3004':1.00,
    '2024':1.01, '6060':1.00, '6063':1.00, '6061':0.995, '6005':1.01,
    '6082':1.02, '7075':1.03, '5083':1.02, '6101':1.00
};

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ =====
function initializeLengthSystem() {
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    const customLengthContainer = document.getElementById('customLengthContainer');
    const customLengthInput = document.getElementById('customLength');
    
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            toggleBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const lengthType = this.getAttribute('data-length');
            
            if (lengthType === 'custom') {
                customLengthContainer.classList.add('active');
                if (!customLengthInput.value) {
                    customLengthInput.value = '6';
                }
            } else {
                customLengthContainer.classList.remove('active');
                updateMeterFromRod();
            }
            saveState();
        });
    });
    
    customLengthInput.addEventListener('input', function() {
        updateMeterFromRod();
        saveState();
    });
}

function getCurrentRodLength() {
    const activeToggle = document.querySelector('.toggle-btn.active');
    const customLengthInput = document.getElementById('customLength');
    
    if (activeToggle && activeToggle.getAttribute('data-length') === 'custom') {
        return parseFloat(customLengthInput.value) || 6;
    } else if (activeToggle) {
        return parseFloat(activeToggle.getAttribute('data-length')) || 6;
    } else {
        return 6;
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ =====
function autoSearchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) return;
    
    document.getElementById('autoFillNotice').style.display = 'block';
    
    setTimeout(() => {
        try {
            const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
            const moldKey = `${moldNumber}/${moldVersion}`;
            const foundMold = moldDatabase[moldKey];
            
            if (foundMold) {
                document.getElementById('rodWeight').value = foundMold.rodWeight;
                document.getElementById('weightPerMeter').value = foundMold.weightPerMeter;
                document.getElementById('numOpenings').value = foundMold.numOpenings;
                document.getElementById('numCuts').value = foundMold.numCuts;
                document.getElementById('alloy').value = foundMold.alloy;
                document.getElementById('buttScrap').value = foundMold.buttScrap || 15;
                document.getElementById('billetDiameter').value = foundMold.billetDiameter || '7';
                
                // ØªØ­Ø¯ÙŠØ« Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ - Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ
                const toggleBtns = document.querySelectorAll('.toggle-btn');
                let lengthFound = false;
                
                toggleBtns.forEach(btn => {
                    if (btn.getAttribute('data-length') === foundMold.rodLength) {
                        btn.click();
                        lengthFound = true;
                    }
                });
                
                if (foundMold.rodLength === 'custom' && foundMold.customLength) {
                    document.getElementById('customLength').value = foundMold.customLength;
                    // ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø°Ù„Ùƒ
                    if (!lengthFound) {
                        document.querySelector('.toggle-btn[data-length="custom"]').click();
                    }
                }
                
                updateMeterFromRod();
                applyAlloyToWeight();
                updateExtrusionRatio();
                
                document.getElementById('autoFillNotice').style.display = 'none';
                showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`, 'success');
                
            } else {
                document.getElementById('autoFillNotice').style.display = 'none';
            }
            
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', e);
            document.getElementById('autoFillNotice').style.display = 'none';
        }
    }, 800);
}

function saveMoldData() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    const rodWeight = document.getElementById('rodWeight').value;
    const weightPerMeter = document.getElementById('weightPerMeter').value;
    const numOpenings = document.getElementById('numOpenings').value;
    const numCuts = document.getElementById('numCuts').value;
    const activeToggle = document.querySelector('.toggle-btn.active');
    const rodLength = activeToggle ? activeToggle.getAttribute('data-length') : '6';
    const customLength = document.getElementById('customLength').value;
    const alloy = document.getElementById('alloy').value;
    const buttScrap = document.getElementById('buttScrap').value;
    const billetDiameter = document.getElementById('billetDiameter').value;

    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    const moldData = {
        rodWeight: rodWeight,
        weightPerMeter: weightPerMeter,
        numOpenings: numOpenings,
        numCuts: numCuts,
        rodLength: rodLength,
        customLength: customLength,
        alloy: alloy,
        buttScrap: buttScrap,
        billetDiameter: billetDiameter,
        timestamp: new Date().toLocaleString('ar-EG'),
        moldNumber: moldNumber,
        moldVersion: moldVersion
    };
    
    try {
        const existingData = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        existingData[moldKey] = moldData;
        localStorage.setItem('moldDatabase', JSON.stringify(existingData));
        
        showTempMessage(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        localStorage.setItem('lastUpdatedMold', moldKey);
        
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        console.error(e);
    }
}

function searchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    try {
        const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        let foundMold = null;
        let foundKey = '';
        
        if (moldVersion) {
            const fullKey = `${moldNumber}/${moldVersion}`;
            foundMold = moldDatabase[fullKey];
            foundKey = fullKey;
        } else {
            const searchPattern = new RegExp(`^${moldNumber}/`);
            for (const key in moldDatabase) {
                if (searchPattern.test(key)) {
                    foundMold = moldDatabase[key];
                    foundKey = key;
                    break;
                }
            }
        }
        
        if (foundMold) {
            document.getElementById('rodWeight').value = foundMold.rodWeight;
            document.getElementById('weightPerMeter').value = foundMold.weightPerMeter;
            document.getElementById('numOpenings').value = foundMold.numOpenings;
            document.getElementById('numCuts').value = foundMold.numCuts;
            document.getElementById('alloy').value = foundMold.alloy;
            document.getElementById('buttScrap').value = foundMold.buttScrap || 15;
            document.getElementById('billetDiameter').value = foundMold.billetDiameter || '7';
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ - Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            let lengthFound = false;
            
            toggleBtns.forEach(btn => {
                if (btn.getAttribute('data-length') === foundMold.rodLength) {
                    btn.click();
                    lengthFound = true;
                }
            });
            
            if (foundMold.rodLength === 'custom' && foundMold.customLength) {
                document.getElementById('customLength').value = foundMold.customLength;
                // ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø°Ù„Ùƒ
                if (!lengthFound) {
                    document.querySelector('.toggle-btn[data-length="custom"]').click();
                }
            }
            
            document.getElementById('moldNumber').value = foundMold.moldNumber;
            document.getElementById('moldVersion').value = foundMold.moldVersion;
            
            updateMeterFromRod();
            applyAlloyToWeight();
            updateExtrusionRatio();
            
            showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${foundKey}`, 'success');
        } else {
            alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«');
        console.error(e);
    }
}

function showAllMolds() {
    try {
        const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        const moldKeys = Object.keys(moldDatabase);
        
        if (moldKeys.length === 0) {
            alert('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯');
            return;
        }
        
        let message = `ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (${moldKeys.length}):

`;
        moldKeys.forEach(key => {
            const mold = moldDatabase[key];
            message += `ğŸ”¸ ${key} - Ø§Ù„ÙˆØ²Ù†: ${mold.rodWeight} ÙƒØ¬Ù… - Ø§Ù„ÙØªØ­Ø§Øª: ${mold.numOpenings} - Ø§Ù„Ù‚ØµØ§Øª: ${mold.numCuts}
`;
            message += `   Ø§Ù„Ø³Ø¨ÙŠÙƒØ©: ${mold.alloy} - Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯: ${mold.rodLength}Ù… - Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³: ${mold.buttScrap || 15}Ù…Ù…

`;
        });
        
        alert(message);
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

function deleteMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ù„Ù„Ø­Ø°Ù');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey}ØŸ`)) {
        try {
            const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
            
            if (moldDatabase[moldKey]) {
                delete moldDatabase[moldKey];
                localStorage.setItem('moldDatabase', JSON.stringify(moldDatabase));
                showTempMessage(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
                document.getElementById('moldNumber').value = '';
                document.getElementById('moldVersion').value = '';
            } else {
                alert('âŒ Ø§Ù„Ù‚Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            }
        } catch (e) {
            alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
        }
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
function calculateBedLength() {
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    
    if (numCuts <= 0) return null;
    
    const netLength = numCuts * rodLength;
    const totalLength = netLength + bedScrapLength;
    
    return {
        netLength: netLength,
        totalLength: totalLength,
        rodLength: rodLength,
        bedScrapLength: bedScrapLength,
        numCuts: numCuts
    };
}

function calculateBilletLength(){
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 0;
    const rodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const billetDiameter = document.getElementById('billetDiameter').value;
    const alloy = document.getElementById('alloy').value;
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const scrapPercentage = parseFloat(document.getElementById('scrapPercentage').value) || 0;
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 0;
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    const desiredTons = parseFloat(document.getElementById('desiredTons').value);
    const buttScrap = parseFloat(document.getElementById('buttScrap').value) || 15;
    const enableScrapSafety = document.getElementById('enableScrapSafety').value === '1';

    if (!numOpenings || !rodWeight || !numCuts || !weightPerCm) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ÙØªØ­Ø§ØªØŒ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§ØªØŒ ÙˆÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù…');
        return;
    }

    const totalRodsCount = numOpenings * numCuts;
    const totalRodsWeight = rodWeight * totalRodsCount;
    const scrapFactor = 1 + (scrapPercentage / 100);
    const safetyFactorValue = 1 + (safetyFactor / 100);
    
    const bedScrapWeight = (bedScrapLength * weightPerMeter * numOpenings);
    let adjustedWeight = totalRodsWeight;
    if (enableScrapSafety) adjustedWeight = adjustedWeight * scrapFactor * safetyFactorValue;
    const finalWeight = adjustedWeight + bedScrapWeight;
    
    // Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³
    const buttScrapCm = buttScrap / 10; // ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ù…Ù… Ø¥Ù„Ù‰ Ø³Ù…
    const billetLengthCm = (finalWeight / weightPerCm) + buttScrapCm;
    const billetWeightKg = billetLengthCm * weightPerCm;

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    document.getElementById('resultOpenings').textContent = numOpenings;
    document.getElementById('resultRodWeight').textContent = rodWeight.toFixed(3);
    document.getElementById('resultWeightPerMeter').textContent = weightPerMeter.toFixed(3);
    document.getElementById('resultCuts').textContent = numCuts;
    document.getElementById('resultRodLength').textContent = rodLength + ' Ù…ØªØ±';
    document.getElementById('resultDiameter').textContent = billetDiameter + ' Ø¨ÙˆØµØ©';
    document.getElementById('resultAlloy').textContent = alloy;
    document.getElementById('resultButtScrap').textContent = buttScrap;

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
    const erDisplay = document.getElementById('resultExtrusionRatio');
    const erValue = parseFloat(document.getElementById('extrusionRatio').value) || 0;
    erDisplay.textContent = isFinite(erValue) ? erValue.toFixed(1) : '0.0';

    document.getElementById('billetLength').textContent = isFinite(billetLengthCm) ? billetLengthCm.toFixed(1) : '0.0';
    document.getElementById('billetWeight').textContent = isFinite(billetWeightKg) ? billetWeightKg.toFixed(1) : '0.0';

    // Ø­Ø³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´
    const bedLengthData = calculateBedLength();
    if (bedLengthData) {
        document.getElementById('bedLengthValue').textContent = `${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±`;
        document.getElementById('bedLengthDetails').innerHTML = `
            <div class="bed-length-step"><strong>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ØµØ§ÙÙŠ:</strong> ${bedLengthData.numCuts} Ù‚ØµÙ‘Ø© Ã— ${bedLengthData.rodLength} Ù…ØªØ± = ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong> ${bedLengthData.bedScrapLength} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</strong> ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ± + ${bedLengthData.bedScrapLength} Ù…ØªØ± = ${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±</div>
        `;
        document.getElementById('bedLengthResult').style.display = 'block';
    }

    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById('calculationDetails').innerHTML = `
        <h4>ğŸ§® Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</h4>
        <div class="step"><strong>1. Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ:</strong><br>${numOpenings} ÙØªØ­Ø© Ã— ${numCuts} Ù‚ØµÙ‘Ø© = ${totalRodsCount} Ø¹ÙˆØ¯</div>
        <div class="step"><strong>2. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong><br>${rodWeight.toFixed(3)} ÙƒØ¬Ù…/Ø¹ÙˆØ¯ Ã— ${totalRodsCount} = ${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>3. Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%):</strong><br>${enableScrapSafety ? (totalRodsWeight.toFixed(3) + ' Ã— ' + scrapFactor.toFixed(3) + ' = ' + (totalRodsWeight*scrapFactor).toFixed(3) + ' ÙƒØ¬Ù…') : 'Ù…Ø¹Ø·Ù„ - Ù„Ø§ ÙŠØ·Ø¨Ù‚'}</div>
        <div class="step"><strong>4. Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%):</strong><br>${enableScrapSafety ? ((totalRodsWeight*scrapFactor).toFixed(3) + ' Ã— ' + safetyFactorValue.toFixed(3) + ' = ' + (totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3) + ' ÙƒØ¬Ù…') : 'Ù…Ø¹Ø·Ù„ - Ù„Ø§ ÙŠØ·Ø¨Ù‚'}</div>
        <div class="step"><strong>5. Ø§Ø­ØªØ³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong><br>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings} ÙØªØ­Ø© = ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>6. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong><br>${(enableScrapSafety ? (totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3) : totalRodsWeight.toFixed(3))} ÙƒØ¬Ù… + ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù… = ${finalWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>7. Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</strong><br>${finalWeight.toFixed(3)} ÙƒØ¬Ù… Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù… = ${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù…</div>
        <div class="step"><strong>8. Ø¥Ø¶Ø§ÙØ© Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ (${buttScrap}Ù…Ù… = ${buttScrapCm.toFixed(1)}Ø³Ù…):</strong><br>${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù… + ${buttScrapCm.toFixed(1)} Ø³Ù… = ${billetLengthCm.toFixed(1)} Ø³Ù…</div>
    `;

    // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„
    const analysisBody = document.getElementById('analysisTableBody');
    analysisBody.innerHTML = '';
    const analysisRows = [
        `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØµØ§ÙÙŠ</td><td>ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµÙ‘Ø§Øª Ã— Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª</td><td>${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%)</td><td>Ã— (1 + ${scrapPercentage/100})</td><td>${(totalRodsWeight * scrapFactor).toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%)</td><td>Ã— (1 + ${safetyFactor/100})</td><td>${(totalRodsWeight * scrapFactor * safetyFactorValue).toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</td><td>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings}</td><td>${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>${(enableScrapSafety ? (totalRodsWeight * scrapFactor * safetyFactorValue).toFixed(3) : totalRodsWeight.toFixed(3))} + ${bedScrapWeight.toFixed(3)}</td><td class="highlight">${finalWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td><td>Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù…</td><td>${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù…</td></tr>`,
        `<tr><td>Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³</td><td>${buttScrap} Ù…Ù… = ${buttScrapCm.toFixed(1)} Ø³Ù…</td><td>+ ${buttScrapCm.toFixed(1)} Ø³Ù…</td></tr>`,
        `<tr><td>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>${(finalWeight / weightPerCm).toFixed(1)} + ${buttScrapCm.toFixed(1)}</td><td class="highlight">${billetLengthCm.toFixed(1)} Ø³Ù…</td></tr>`
    ];
    analysisBody.innerHTML = analysisRows.join('');
    document.getElementById('analysisBlock').style.display = 'block';

    // Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù†
    let summaryHtml = '';
    if (!isNaN(desiredTons) && desiredTons > 0) {
        const desiredKg = desiredTons * 1000;
        const billetsNeeded = Math.ceil(desiredKg / billetWeightKg);
        const rodsProduced = billetsNeeded * totalRodsCount;
        const producedKg = billetsNeeded * billetWeightKg;
        const diffKg = producedKg - desiredKg;

        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ù„Ø·Ù„Ø¨ ${desiredTons} Ø·Ù† (Ø£ÙŠ ${desiredKg.toLocaleString()} ÙƒØ¬Ù…):</strong><br>`;
        summaryHtml += `â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <strong>${billetsNeeded.toLocaleString()}</strong> Ø¨Ù„ÙŠØª<br>`;
        summaryHtml += `â€¢ ÙƒÙ„ Ø¨Ù„ÙŠØª ÙŠØ²Ù† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§: <strong>${billetWeightKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„Ù†Ø§ØªØ¬Ø©: <strong>${rodsProduced.toLocaleString()}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ù†Ø§ØªØ¬: <strong>${producedKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <strong>${diffKg >= 0 ? '+' : ''}${diffKg.toFixed(1)} ÙƒØ¬Ù…</strong>`;
    } else {
        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø²Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯: <strong>${totalRodsCount}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ ÙˆØ²Ù† Ø§Ù„Ø­Ø²Ù…Ø©: <strong>${finalWeight.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª: <strong>${billetLengthCm.toFixed(1)} Ø³Ù…</strong><br>`;
        summaryHtml += `â€¢ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³: <strong>${buttScrap} Ù…Ù…</strong>`;
    }
    document.getElementById('summaryBox').innerHTML = summaryHtml;

    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });

    saveState();
}

// ===== Ø¯ÙˆØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© =====
function updateExtrusionRatio() {
    // ER = (billet weight per cm) / (profile weight per cm)
    // profile weight per cm = weightPerMeter / 100
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const billetDiameter = document.getElementById('billetDiameter').value;

    const profileWeightPerCm = weightPerMeter / 100; // kg/cm for profile

    let er = 0;
    if (profileWeightPerCm > 0) {
        er = weightPerCm / profileWeightPerCm; // ratio like 50 means 50:1
    } else {
        // fallback: estimate weightPerCm from rodWeight and rodLength
        const rodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
        const rodLength = getCurrentRodLength() || 6;
        const profilePerCmFallback = (rodWeight / rodLength) / 100; // kg/cm
        if (profilePerCmFallback > 0) {
            er = weightPerCm / profilePerCmFallback;
        }
    }

    // write back to field and clamp sensible values
    const erRounded = isFinite(er) ? Math.max(0.1, parseFloat(er.toFixed(1))) : 0;
    document.getElementById('extrusionRatio').value = erRounded;
    // also update display in results if visible
    const erDisplay = document.getElementById('resultExtrusionRatio');
    if (erDisplay) erDisplay.textContent = erRounded.toFixed(1);
}

// ===== Ø¯ÙˆØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ø¹ÙƒØ³ÙŠ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…ØµØ­Ø­ =====
function computeFromBilletLength() {
    const inputLengthCm = parseFloat(document.getElementById('inputBilletLength').value);
    if (!inputLengthCm || inputLengthCm <= 0) return;

    const buttScrap = parseFloat(document.getElementById('buttScrap').value) || 15;
    const buttScrapCm = buttScrap / 10;
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 0;
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const enableScrapSafety = document.getElementById('enableScrapSafety').value === '1';
    const scrapPercentage = parseFloat(document.getElementById('scrapPercentage').value) || 0;
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 0;
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;

    const totalRodsCount = numOpenings * numCuts;
    if (totalRodsCount <= 0) return;

    // === Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ø­Ø³Ø§Ø¨ Ù…Ø¹ÙƒÙˆØ³ Ø¯Ù‚ÙŠÙ‚ ===
    
    // 1. Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª (Ø¨Ø¹Ø¯ Ø·Ø±Ø­ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³)
    const basicBilletLength = inputLengthCm - buttScrapCm;
    
    // 2. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    const basicBilletWeight = basicBilletLength * weightPerCm;
    
    // 3. Ø­Ø³Ø§Ø¨ ÙˆØ²Ù† Ù‡Ø§Ù„Ùƒ Ø§Ù„ÙØ±Ø´
    let weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    if (!weightPerMeter || weightPerMeter === 0) {
        const currentRodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
        if (currentRodWeight > 0) {
            weightPerMeter = (currentRodWeight / rodLength);
        } else {
            weightPerMeter = weightPerCm * 100;
        }
        document.getElementById('weightPerMeter').value = weightPerMeter.toFixed(3);
    }
    const bedScrapWeight = bedScrapLength * weightPerMeter * numOpenings;
    
    // 4. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø¨Ø¹Ø¯ Ø·Ø±Ø­ Ù‡Ø§Ù„Ùƒ Ø§Ù„ÙØ±Ø´
    const availableWeightForRods = basicBilletWeight - bedScrapWeight;
    
    // 5. Ø§Ø­ØªØ³Ø§Ø¨ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù†
    let netWeightForRods;
    if (enableScrapSafety) {
        const scrapFactor = 1 + (scrapPercentage / 100);
        const safetyFactorValue = 1 + (safetyFactor / 100);
        const totalFactor = scrapFactor * safetyFactorValue;
        netWeightForRods = availableWeightForRods / totalFactor;
    } else {
        netWeightForRods = availableWeightForRods;
    }
    
    // 6. Ø­Ø³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
    const computedRodWeight = totalRodsCount > 0 ? netWeightForRods / totalRodsCount : 0;
    const computedWeightPerMeter = rodLength > 0 ? computedRodWeight / rodLength : 0;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØµØ­ÙŠØ­Ø©
    if (isFinite(computedRodWeight) && computedRodWeight > 0 && isFinite(computedWeightPerMeter) && computedWeightPerMeter > 0) {
        document.getElementById('rodWeight').value = computedRodWeight.toFixed(3);
        document.getElementById('weightPerMeter').value = computedWeightPerMeter.toFixed(3);

        // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
        updateExtrusionRatio();
        saveState();

        showTempMessage(`ğŸ” ØªÙ… Ø­Ø³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (${computedRodWeight.toFixed(3)} ÙƒØ¬Ù…) ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (${computedWeightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù…) Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª`,'success');
    } else {
        showTempMessage('âš ï¸ ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.', 'error');
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© =====
function showTempMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
        position: fixed;
        top: 15px;
        right: 15px;
        padding: 10px 16px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        transition: opacity 0.3s;
        ${type === 'success' ? 'background: #27ae60;' : type === 'error' ? 'background: #e74c3c;' : 'background: #3498db;'}
        font-size: 13px;
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(messageDiv);
        }, 300);
    }, 3000);
}

function updateRodFromMeter() {
    const m = parseFloat(document.getElementById('weightPerMeter').value);
    const rodLength = getCurrentRodLength();
    if (!isNaN(m)) {
        document.getElementById('rodWeight').value = (m * rodLength).toFixed(3);
    }
    updateExtrusionRatio();
}

function updateMeterFromRod() {
    const r = parseFloat(document.getElementById('rodWeight').value);
    const rodLength = getCurrentRodLength();
    if (!isNaN(r)) {
        document.getElementById('weightPerMeter').value = (r / rodLength).toFixed(3);
    }
    updateExtrusionRatio();
}

function applyAlloyToWeight(){
    const diam = document.getElementById('billetDiameter').value;
    const alloy = document.getElementById('alloy').value;
    const base = baseBilletWeights[diam] || 0.67;
    const factor = alloyFactor[alloy] || 1.0;
    const newVal = (base * factor).toFixed(3);
    document.getElementById('weightPerCm').value = parseFloat(newVal);
    updateExtrusionRatio();
}

// ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© =====
function saveState() {
    const state = {
        numOpenings: document.getElementById('numOpenings').value,
        rodWeight: document.getElementById('rodWeight').value,
        weightPerMeter: document.getElementById('weightPerMeter').value,
        numCuts: document.getElementById('numCuts').value,
        billetDiameter: document.getElementById('billetDiameter').value,
        alloy: document.getElementById('alloy').value,
        weightPerCm: document.getElementById('weightPerCm').value,
        extrusionRatio: document.getElementById('extrusionRatio').value,
        scrapPercentage: document.getElementById('scrapPercentage').value,
        safetyFactor: document.getElementById('safetyFactor').value,
        bedScrapLength: document.getElementById('bedScrapLength').value,
        buttScrap: document.getElementById('buttScrap').value,
        desiredTons: document.getElementById('desiredTons').value,
        moldNumber: document.getElementById('moldNumber').value,
        moldVersion: document.getElementById('moldVersion').value,
        customLength: document.getElementById('customLength').value,
        activeLength: document.querySelector('.toggle-btn.active')?.getAttribute('data-length') || '6',
        enableScrapSafety: document.getElementById('enableScrapSafety').value,
        inputBilletLength: document.getElementById('inputBilletLength').value
    };
    try { 
        localStorage.setItem('billetCalculatorState', JSON.stringify(state)); 
    } catch(e){
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©:', e);
    }
}

function loadState() {
    try {
        const s = JSON.parse(localStorage.getItem('billetCalculatorState') || '{}');
        if (s.numOpenings) document.getElementById('numOpenings').value = s.numOpenings;
        if (s.rodWeight) document.getElementById('rodWeight').value = s.rodWeight;
        if (s.weightPerMeter) document.getElementById('weightPerMeter').value = s.weightPerMeter;
        if (s.numCuts) document.getElementById('numCuts').value = s.numCuts;
        if (s.billetDiameter) document.getElementById('billetDiameter').value = s.billetDiameter;
        if (s.alloy) document.getElementById('alloy').value = s.alloy;
        if (s.weightPerCm) document.getElementById('weightPerCm').value = s.weightPerCm;
        if (s.extrusionRatio) document.getElementById('extrusionRatio').value = s.extrusionRatio;
        if (s.scrapPercentage) document.getElementById('scrapPercentage').value = s.scrapPercentage;
        if (s.safetyFactor) document.getElementById('safetyFactor').value = s.safetyFactor;
        if (s.bedScrapLength) document.getElementById('bedScrapLength').value = s.bedScrapLength;
        if (s.buttScrap) document.getElementById('buttScrap').value = s.buttScrap;
        if (s.desiredTons) document.getElementById('desiredTons').value = s.desiredTons;
        if (s.moldNumber) document.getElementById('moldNumber').value = s.moldNumber;
        if (s.moldVersion) document.getElementById('moldVersion').value = s.moldVersion;
        if (s.customLength) document.getElementById('customLength').value = s.customLength;
        if (s.enableScrapSafety !== undefined) document.getElementById('enableScrapSafety').value = s.enableScrapSafety;
        if (s.inputBilletLength) document.getElementById('inputBilletLength').value = s.inputBilletLength;
        
        if (s.activeLength) {
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            toggleBtns.forEach(btn => {
                if (btn.getAttribute('data-length') === s.activeLength) {
                    btn.click();
                }
            });
        }
    } catch(e){
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©:', e);
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ© =====
function printReport(){
    const header = `<h2 style="text-align:center">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù„ÙŠØª</h2><p style="text-align:center">Ù…Ù‚Ø¯Ù…Ø© Ø¥Ù„ÙŠÙƒÙ… Ù…Ù† ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</p><hr/>`;
    const content = document.getElementById('result').innerHTML;
    const newWindow = window.open('','_blank','width=900,height=700');
    newWindow.document.write(`<html><head><title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ù„ÙŠØª</title></head><body>${header}${content}</body></html>`);
    newWindow.document.close();
    newWindow.focus();
    setTimeout(()=>{ newWindow.print(); },300);
}

function resetForm(){
    document.getElementById('numOpenings').value = '4';
    document.getElementById('rodWeight').value = '1.2';
    document.getElementById('weightPerMeter').value = '0.200';
    document.getElementById('numCuts').value = '8';
    document.getElementById('billetDiameter').value = '7';
    document.getElementById('alloy').value = '6063';
    document.getElementById('weightPerCm').value = '0.670';
    document.getElementById('extrusionRatio').value = '30';
    document.getElementById('scrapPercentage').value = '5';
    document.getElementById('safetyFactor').value = '10';
    document.getElementById('bedScrapLength').value = '1.5';
    document.getElementById('buttScrap').value = '15';
    document.getElementById('desiredTons').value = '';
    document.getElementById('moldNumber').value = '';
    document.getElementById('moldVersion').value = '';
    document.getElementById('customLength').value = '6';
    document.getElementById('customLengthContainer').classList.remove('active');
    document.getElementById('enableScrapSafety').value = '1';
    document.getElementById('inputBilletLength').value = '';
    
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    toggleBtns.forEach(btn => {
        if (btn.getAttribute('data-length') === '6') {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    document.getElementById('result').style.display = 'none';
    saveState();
}

// ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
document.addEventListener('DOMContentLoaded', function() {
    // ØªÙ‡ÙŠØ¦Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø·ÙˆÙ„
    initializeLengthSystem();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    loadState();
    applyAlloyToWeight();
    updateMeterFromRod();
    updateExtrusionRatio();
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.getElementById('calculateBtn').addEventListener('click', calculateBilletLength);
    document.getElementById('resetBtn').addEventListener('click', resetForm);
    document.getElementById('printBtn').addEventListener('click', printReport);
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
    document.getElementById('saveMoldBtn').addEventListener('click', saveMoldData);
    document.getElementById('searchMoldBtn').addEventListener('click', searchMold);
    document.getElementById('showMoldsBtn').addEventListener('click', showAllMolds);
    document.getElementById('deleteMoldBtn').addEventListener('click', deleteMold);
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø®Ø±Ù‰
    document.getElementById('billetDiameter').addEventListener('change', function(){ 
        applyAlloyToWeight(); 
        saveState(); 
    });
    
    document.getElementById('alloy').addEventListener('change', function(){ 
        applyAlloyToWeight(); 
        saveState(); 
    });
    
    document.getElementById('weightPerMeter').addEventListener('input', () => { 
        updateRodFromMeter(); 
        saveState(); 
    });
    
    document.getElementById('rodWeight').addEventListener('input', () => { 
        updateMeterFromRod(); 
        saveState(); 
    });

    // when weightPerCm manually changed, recalc ER
    document.getElementById('weightPerCm').addEventListener('input', () => {
        updateExtrusionRatio();
        saveState();
    });

    // extrusionRatio manual changes are allowed but update display
    document.getElementById('extrusionRatio').addEventListener('input', () => {
        const erVal = parseFloat(document.getElementById('extrusionRatio').value) || 0;
        document.getElementById('resultExtrusionRatio').textContent = erVal.toFixed(1);
        saveState();
    });
    
    document.getElementById('moldNumber').addEventListener('input', function() {
        if (document.getElementById('moldVersion').value.trim()) {
            setTimeout(autoSearchMold, 500);
        }
    });
    
    document.getElementById('moldVersion').addEventListener('input', function() {
        if (document.getElementById('moldNumber').value.trim()) {
            setTimeout(autoSearchMold, 500);
        }
    });
    
    const watched = document.querySelectorAll('input, select');
    watched.forEach(el => el.addEventListener('change', saveState));
    
    // Ø­Ø³Ø§Ø¨ Ø¹ÙƒØ³ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª - Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« change Ø£ÙŠØ¶Ù‹Ø§
    document.getElementById('inputBilletLength').addEventListener('input', () => {
        computeFromBilletLength();
    });
    
    document.getElementById('inputBilletLength').addEventListener('change', () => {
        computeFromBilletLength();
    });

    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„');
});

// ===== PWA Installation =====
let deferredPrompt;
const installButton = document.getElementById('installButton');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installButton.style.display = 'block';
});

installButton.addEventListener('click', async () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            installButton.style.display = 'none';
            console.log('âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        }
        deferredPrompt = null;
    }
});

window.addEventListener('appinstalled', () => {
    installButton.style.display = 'none';
    deferredPrompt = null;
    console.log('ğŸ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²');
});

if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                console.log('âœ… ServiceWorker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:', registration.scope);
            })
            .catch(function(err) {
                console.log('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ ServiceWorker:', err);
            });
    });
}
</script>
</body>
</html>